<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=/css/main.css media=all><title>braveheat.xyz | 向量数据库产品横向对比</title></head><body><div id=container><header class=site-header><h1 class=site-title><a href=/>braveheat.xyz</a></h1></header><hr class=site-header-bottom><div id=content><div class=main role=main><article role=article class=article itemscope itemtype=http://schema.org/BlogPosting><header class=header><h1 class=title itemprop="name headline">向量数据库产品横向对比</h1><span class=meta><time class=date datetime=2022-05-12T14:05:43+07:00 itemprop=datePublished>2022/05/12</time></span>
<span class=tags><a class=tag href=/tags/dbms/><i class="fas fa-tag"></i>
#dbms</a>
<a class=tag href=/tags/ann/><i class="fas fa-tag"></i>
#ann</a></span></header><p>最近对向量数据库做了一些调研，这篇文章是结果的汇总，涵盖目前能找到的大部分具备向量检索能力的开源和商业产品。信息来源主要是各个产品公开的用户文档，不确定的地方标注了“?”。</p><h2 id=数据模型>数据模型</h2><table><thead><tr><th>数据库</th><th>数据模型</th><th>多向量字段</th><th>向量类型</th><th>标量类型</th><th>Schema-Free</th><th>主键</th></tr></thead><tbody><tr><td>Milvus</td><td>表 + 向量</td><td></td><td>float(4B)/binary</td><td>int/float/bool</td><td></td><td>uint64</td></tr><tr><td>vearch</td><td>表 + 向量</td><td>Y</td><td>float</td><td>string/integer/long/float/double</td><td></td><td>string</td></tr><tr><td>阿里云 ADB</td><td>表 + 向量</td><td>Y?</td><td>float</td><td>参考 MySQL/PG 类型</td><td></td><td></td></tr><tr><td>pgvector</td><td>表 + 向量</td><td>Y</td><td>float(4B)</td><td>参考 PG 类型</td><td></td><td></td></tr><tr><td>ES</td><td>文档 + 向量</td><td>Y</td><td>float</td><td>参考 ES 类型</td><td>Y</td><td>string</td></tr><tr><td>Pinecone</td><td>文档 + 向量</td><td></td><td>float</td><td>标量字段保存在 Json</td><td>Y</td><td>string</td></tr><tr><td>qdrant</td><td>文档 + 向量</td><td></td><td>float</td><td>标量字段保存在 Json</td><td>Y</td><td>uint64/UUID</td></tr><tr><td>vespa</td><td>文档 + 向量</td><td>Y</td><td>float/int</td><td><a href=https://docs.vespa.ai/en/reference/schema-reference.html#field-types>支持类型较多，参考文档</a></td><td></td><td>string</td></tr><tr><td>weaviate</td><td>文档 + 向量</td><td></td><td>float</td><td><a href=https://weaviate.io/developers/weaviate/current/data-schema/datatypes.html>支持类型较多，参考文档</a></td><td>Y<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></td><td>UUID</td></tr><tr><td>vald</td><td>向量</td><td></td><td>float</td><td>N/A</td><td>N/A</td><td>string</td></tr></tbody></table><h2 id=索引类型>索引类型</h2><p><strong>向量相似性度量</strong></p><table><thead><tr><th>数据库</th><th>余弦</th><th>L2(欧式)</th><th>内积</th><th>Jaccard</th><th>Hamming</th><th>L1(曼哈顿)</th><th>Poincare</th><th>Lorentz</th><th>其他</th></tr></thead><tbody><tr><td>Milvus</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td><td></td><td>Y<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></td></tr><tr><td>vearch</td><td></td><td>Y</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>阿里云 ADB<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup></td><td></td><td>Y</td><td>Y</td><td></td><td>Y</td><td></td><td></td><td></td><td></td></tr><tr><td>pgvector</td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>ES</td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Pinecone</td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>qdrant</td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>vespa</td><td>Y</td><td></td><td>Y</td><td></td><td>Y</td><td></td><td></td><td></td><td></td></tr><tr><td>weaviate</td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td>Y<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup></td></tr><tr><td>vald<sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup></td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td></td></tr></tbody></table><p><strong>索引算法</strong></p><table><thead><tr><th>数据库</th><th>FLAT</th><th>IVF</th><th>SQ8</th><th>PQ</th><th>HNSW</th><th>RHNSW</th><th>ANNOY</th><th>NSG</th></tr></thead><tbody><tr><td>Milvus</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>?<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup></td></tr><tr><td>vearch</td><td>Y</td><td>Y</td><td></td><td>Y</td><td>Y</td><td></td><td></td><td></td></tr><tr><td>阿里云 ADB<sup id=fnref:7><a href=#fn:7 class=footnote-ref role=doc-noteref>7</a></sup></td><td></td><td></td><td></td><td>Y</td><td>Y</td><td></td><td></td><td></td></tr><tr><td>pgvector</td><td></td><td>Y</td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>ES</td><td></td><td></td><td></td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>Pinecone<sup id=fnref:8><a href=#fn:8 class=footnote-ref role=doc-noteref>8</a></sup></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>qdrant</td><td></td><td></td><td></td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>vespa</td><td></td><td></td><td></td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>weaviate</td><td></td><td></td><td></td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>vald<sup id=fnref:9><a href=#fn:9 class=footnote-ref role=doc-noteref>9</a></sup></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id=查询>查询</h2><table><thead><tr><th>数据库</th><th>brute-force<sup id=fnref:10><a href=#fn:10 class=footnote-ref role=doc-noteref>10</a></sup></th><th>混合检索</th><th>多向量查询</th><th>sort</th><th>aggregation</th></tr></thead><tbody><tr><td>Milvus</td><td>Y</td><td>Y</td><td>?<sup id=fnref:11><a href=#fn:11 class=footnote-ref role=doc-noteref>11</a></sup></td><td></td><td></td></tr><tr><td>vearch</td><td>Y</td><td>Y</td><td>Y<sup id=fnref:12><a href=#fn:12 class=footnote-ref role=doc-noteref>12</a></sup></td><td>Y</td><td></td></tr><tr><td>阿里云 ADB</td><td>Y</td><td>Y</td><td>?</td><td>Y</td><td>Y</td></tr><tr><td>pgvector</td><td>?</td><td>Y</td><td>?</td><td>Y</td><td>Y</td></tr><tr><td>ES<sup id=fnref:13><a href=#fn:13 class=footnote-ref role=doc-noteref>13</a></sup></td><td>Y</td><td></td><td></td><td></td><td></td></tr><tr><td>Pinecone</td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>qdrant</td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>vespa</td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>weaviate</td><td></td><td>Y</td><td></td><td></td><td></td></tr><tr><td>vald</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 id=其他功能>其他功能</h2><table><thead><tr><th>数据库</th><th>GPU</th><th>标量索引</th><th>特征提取</th><th>多名字空间</th><th>分布式</th><th>托管服务</th><th>开源</th><th>Time Travel</th></tr></thead><tbody><tr><td>Milvus</td><td>Y</td><td>Y<sup id=fnref:14><a href=#fn:14 class=footnote-ref role=doc-noteref>14</a></sup></td><td></td><td>Y</td><td>Y</td><td></td><td>Y</td><td>Y</td></tr><tr><td>vearch</td><td>Y</td><td>Y</td><td></td><td>Y</td><td>Y</td><td></td><td>Y</td><td></td></tr><tr><td>阿里云 ADB</td><td></td><td>Y</td><td>Y<sup id=fnref:15><a href=#fn:15 class=footnote-ref role=doc-noteref>15</a></sup></td><td>Y</td><td>Y</td><td>Y</td><td></td><td></td></tr><tr><td>pgvector</td><td></td><td>Y</td><td></td><td>Y</td><td></td><td></td><td>Y</td><td></td></tr><tr><td>ES</td><td></td><td></td><td></td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td></td></tr><tr><td>Pinecone</td><td></td><td></td><td></td><td>Y</td><td></td><td>Y</td><td></td><td></td></tr><tr><td>qdrant</td><td></td><td>Y</td><td></td><td>Y</td><td>Y</td><td></td><td>Y</td><td></td></tr><tr><td>vespa</td><td></td><td>Y</td><td></td><td>Y</td><td>Y</td><td></td><td>Y</td><td></td></tr><tr><td>weaviate</td><td>Y</td><td>Y</td><td>Y</td><td></td><td>Y</td><td>Y</td><td>Y</td><td></td></tr><tr><td>vald</td><td></td><td></td><td></td><td></td><td>Y</td><td></td><td>Y</td><td></td></tr></tbody></table><h2 id=总结>总结</h2><p>从产品形态上来看，大部分产品都是在表或者文档的基础上增加向量索引功能，真正把向量作为 first class citizen 的并不多。Milvus 算一个，Pinecone 和 qdrant 勉强可以算是，vald 虽然只存储向量，但是从产品成熟度上来讲差得还比较多。</p><p>在相似性度量方面，使用频率最高的是余弦、内积和欧式距离三种。索引算法中最常用的是基于图的 HNSW，因为它对数据的更新更友好，所以更适用于数据库产品。但是 HNSW 对存储空间的占用比较大，如果要把索引放在内存来提升查询性能的话，就不能不考虑这个问题。</p><p>在查询能力上，向量和标量的混合检索是一个很重要的功能。大部分产品都会在一定程度上提供支持，在以向量为 first class citizen 的产品中，通常是以属性过滤的形式，对向量查询的结果进行二次筛选。而其他产品（比如 Elastic Search）中，可能是根据标量字段进行检索，再用 brute force 的方式对向量字段进行排序。根据 Milvus 的论文，这两种方式它都是支持的，执行时会根据代价选择最合适的查询方式。</p><p>另外一个值得关注的功能是多向量查询，Milvus 在它的论文里特别强调了多向量查询的重要性，用了一节的内容来讨论这个问题。不过我对这个问题有点疑问。在需要多个向量的场景里，是不是可以把多个向量拼接成一个大的向量，转换成单向量的索引和查询来解决？</p><p>在其他一些能力上，我认为 GPU 加速是非常值得关注的。GPU 本身就是非常适合进行向量计算的，用它来加速向量索引的构建和查询，应该都有不错的效果。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Weaviate 支持 auto-schema，可以不用手动创建 schema。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Milvus 还支持 Tanimoto、SuperStructure、Subsctructure 三种相似性度量，都是用于衡量化学物质的相似性。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>ADB-PostgresQL 文档说只有 L2 距离支持索引查询，内积和汉明距离只支持暴力搜索。&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p>vespa 支持 Geodegree 相似性度量，也就是两个经纬度坐标之间的距离，这里是球面距离，而非平面上的欧式距离。&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p>vald 支持的相似性度量需要在服务配置中指定，不能动态变更。&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p>这篇<a href=https://zhuanlan.zhihu.com/p/105594786>知乎文章</a>上介绍说支持 NSG，但文档里没找到。&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:7><p>从文档来看，ADB 似乎是把 PQ 和 HNSW 两种算法结合在一起来使用了。&#160;<a href=#fnref:7 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:8><p>Pinecone 文档没有给出使用的索引算法。&#160;<a href=#fnref:8 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:9><p>vald 底层使用雅虎开源的 NGT 库，使用的算法为自己发表的<a href=https://github.com/yahoojapan/NGT#publications>ONNG、PANNG、ANNGT、ANNG 等</a>。&#160;<a href=#fnref:9 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:10><p>FLAT 索引等同于暴力搜索。其他索引算法都是有精度损失的，暴力搜索虽然慢，但是可以保证精度 100%。&#160;<a href=#fnref:10 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:11><p>论文里说支持，但是文档里没有。根据官网文档，Collection 只支持一个向量字段，不可能做多向量查询。根据<a href=https://github.com/milvus-io/milvus/issues/12680>这个 issue</a>，多向量字段应该是新版本禁掉了。&#160;<a href=#fnref:11 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:12><p>多个向量字段同时查询，结果是各自查询结果的交集。&#160;<a href=#fnref:12 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:13><p>从文档看，knn search api 是不支持跟其他字段混合检索的，但是在普通查询中可以用 dense_vector 字段给文档打分，采用的是 brute force 检索方式。多向量查询也可以用自定义打分函数的方式实现。&#160;<a href=#fnref:13 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:14><p>根据论文中的说明，Milvus 的标量属性是以列存方式存储的，按值排序的，相当于索引了。&#160;<a href=#fnref:14 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:15><p>示例中有用到一些特征提取函数，不确定是否已经集成在产品里，但是可以支持<a href=https://help.aliyun.com/document_detail/117843.html>注册用户自定义函数</a>进行特征提取。&#160;<a href=#fnref:15 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article></div></div></div></body></html>